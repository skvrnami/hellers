window.Npw=window.Npw||{};(function(b,c,d){function a(e){b.Utils.log("[Window] "+e)}b.Window=function(){};b.Window.prototype.updateStatus=function(f){var g=b.state.chatStatus();var e=b.state.windowStatus();var h=b.state.helpStatus();c("#"+b.identifiers.getChatWindowId()).attr("class",g.cssClasses).addClass(e.cssClasses).addClass(h.cssClasses);c("#"+b.identifiers.getChatWrapperId()).draggable("option","disabled",!e.draggable).resizable("option","disabled",!e.resizable);if(g===b.ChatStatusTypes.FINISHED){c("#"+b.identifiers.getEmailInputId()).focus()}if(f){b.window.updatePositionAndSize()}};b.Window.prototype.updatePositionAndSize=function(){a("Updating window position and size");var h=c("#"+b.identifiers.getChatWrapperId());var g=c("#"+b.identifiers.getMessagesWrapperId());var f=b.state.windowPositionAndSize();if(b.state.windowStatus()===b.WindowStatusTypes.EXPANDED&&!f.defaultPosition){if(f.dragged){a("Window has been dragged");h.addClass("npw-is-dragged")}var e=h.position();if(f.topAndLeft&&(e.top!==f.topAndLeft.top||e.left!==f.topAndLeft.left)){a("Updating window position: "+f.topAndLeft);h.css(f.topAndLeft)}if(h.width()!==f.width){a("Updating window width: "+f.width);h.width(f.width)}if(h.height()!==f.height){a("Updating window height: "+f.height);h.height(f.height)}if(g.height()!==f.messageWrapperHeight){a("Updating message wrapper height: "+f.messageWrapperHeight);g.height(f.messageWrapperHeight)}}else{if(b.state.windowStatus()===b.WindowStatusTypes.COLLAPSED){a("Resetting window position and size");h.removeClass("npw-is-dragged").css("top","").css("left","").css("width","").css("height","").css("position","")}}};b.Window.prototype.addMessage=function(i,l,k){l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");l=l.replace(/(?:\r\n|\r|\n)/g,"<br>");switch(i){case b.MessageTypes.INCOMING_WARNING:var g=c("<div>"+l+"</div>");if(k){g.attr("title",k)}c("#"+b.identifiers.getStatusWarningsWrappedId()).html(g);break;case b.MessageTypes.INCOMING_GOODBYE:var f=c("<div>"+l+"</div>");if(k){f.attr("title",k)}c("#"+b.identifiers.getGoodbyeMessageWrapperID()).html(f);break;default:var e=c("#"+b.identifiers.getMessagesWrapperId());var h=c("<div class='"+i.cssClasses+"'>"+l+"</div>");if(k){h.attr("title",k)}e.append(h);var j=c("#"+b.identifiers.getMessagesWrapperId()+" .npw-message:last");if(j&&j.offset()){e.scrollTop(j.offset().top)}}};b.Window.prototype.hideWarningMessage=function(){c("#"+b.identifiers.getStatusWarningsWrappedId()).html("")};b.Window.prototype.positionAndSize=function(){var g=c("#"+b.identifiers.getChatWrapperId());var e=g.position();var f=c("#"+b.identifiers.getMessagesWrapperId());return{defaultPosition:false,dragged:g.hasClass("npw-is-dragged"),topAndLeft:{top:e.top,left:e.left},width:g.width(),height:g.height(),messageWrapperHeight:f.height()}};b.Window.prototype.showHelp=function(){c("#"+b.identifiers.getChatWindowId()).addClass("npw-is-help")};b.Window.prototype.closeHelp=function(){c("#"+b.identifiers.getChatWindowId()).removeClass("npw-is-help")};b.Window.prototype.setTitle=function(e){c("#"+b.identifiers.getChatWindowTitleWrapperId()).text(e)};b.Window.prototype.showOrHideOfflineError=function(e){c("#"+b.identifiers.getChatOfflineErrorWrapperId()).toggleClass("npw-is-hidden",!e)};b.Window.prototype.showEmailSendingConfirmation=function(){c("#"+b.identifiers.getGoodbyeMessageWrapperID()).addClass("npw-is-hidden");c("#"+b.identifiers.getEmailSendingConfirmationWrapperId()).removeClass("npw-is-hidden");c("#"+b.identifiers.getEmailSendingErrorWrapperId()).addClass("npw-is-hidden")};b.Window.prototype.showEmailSendingError=function(){c("#"+b.identifiers.getGoodbyeMessageWrapperID()).addClass("npw-is-hidden");c("#"+b.identifiers.getEmailSendingConfirmationWrapperId()).addClass("npw-is-hidden");c("#"+b.identifiers.getEmailSendingErrorWrapperId()).removeClass("npw-is-hidden")};b.Window.prototype.updateMessageWrapperHeight=function(h){var f=c("#"+b.identifiers.getMessagesWrapperId());var g=f.height();var e=g+h;if(e!==g){a("Updating message wrapper. Delta: "+h+", original height: "+g+", new height: "+e);f.height(e)}}}(Npw.ChatKeeper=Npw.ChatKeeper||{},jQuery));