window.Npw=window.Npw||{};(function(a,b,c){a.Api=function(e,d){this.portletNamespace=e;this.urls=d};a.Api.prototype.enable=function(d){a.Api.log("GET /enable");this.get(this.urls.enable,{},d)};a.Api.prototype.refresh=function(e,d){a.Api.log("GET /refresh");var f={};f[this.portletNamespace+"lastMessageIndex"]=e;this.get(this.urls.refresh,f,d)};a.Api.prototype.send=function(g,e,d){a.Api.log("GET /send");var f={};f[this.portletNamespace+"text"]=g;f[this.portletNamespace+"lastMessageIndex"]=e;this.get(this.urls.send,f,d)};a.Api.prototype.finish=function(e,d){a.Api.log("GET /finish");var f={};f[this.portletNamespace+"lastMessageIndex"]=e;this.get(this.urls.finish,f,d)};a.Api.prototype.close=function(d){a.Api.log("GET /close");this.get(this.urls.close,{},d)};a.Api.prototype.expand=function(f,d){a.Api.log("GET /expand");var e={};e[this.portletNamespace+"expandedManually"]=f?true:false;this.get(this.urls.expand,e,d)};a.Api.prototype.collapse=function(d){a.Api.log("GET /collapse");this.get(this.urls.collapse,{},d)};a.Api.prototype.prepareStartOver=function(d){a.Api.log("GET /prepareStartOver");this.get(this.urls.prepareStartOver,{},d)};a.Api.prototype.transcript=function(e,d,g){a.Api.log("GET /transcript");var f={};f[this.portletNamespace+"email"]=e;this.get(this.urls.transcript,f,d,g)};a.Api.prototype.get=function(e,f,d,g){b.ajax({dataType:"json",url:e,data:f,async:false,cache:false,method:"POST"}).done(d).fail(function(h,j,i){a.Api.log("Api call failed. Http status: "+h.status+", text status: "+j+", error thrown: "+i);if(g){g(h,j,i)}else{a.defaultAjaxFailureCallback(h,j,i)}})};a.Api.log=function(d){a.Utils.log("[Api] "+d)}}(Npw.ChatKeeper=Npw.ChatKeeper||{},jQuery));