window.PuiTheme=window.PuiTheme||{};(function(a,b){a.CSOBLive=function(c){var d=this;d._initCSOBLive(c)};b.extend(a.CSOBLive,{_instances:{},_defaultInstance:"_default",initWidget:function(f,e,d){var c=a.CSOBLive.getInstance(d);if(typeof c==="undefined"){c=new a.CSOBLive(f);a.CSOBLive._setInstance(c,d)}c.init(e)},getInstance:function(c){if(typeof c==="undefined"){c=a.CSOBLive._defaultInstance}return a.CSOBLive._instances[c]},_setInstance:function(c,d){if(typeof d==="undefined"){d=a.CSOBLive._defaultInstance}a.CSOBLive._instances[d]=c}});b.extend(a.CSOBLive.prototype,{_defaults:{selectors:{html:"html",componentSelector:".pui-m-csob-live",componentContent:".html-b-content",chatComponent:".npw-c-chat",callback:".html-callback",video:".html-video",navWrapper:".html-b-nav-wrapper",navItem:".html-nav",chatStatusContent:".npw-status-content",statusContent:".html-status-content",navChat:".html-nav-chat",navCallback:".html-nav-callback",navVideo:".html-nav-video",minimizeButton:".html-is-minimize",npwChatStatus:".npw-status-bar",ctaResponseSuccess:".npw-form-response-success",ctaResponseError:".npw-form-response-error",isVideo:".pui-is-video",isChat:".pui-is-chat",ctaOutputVideoSuccess:".html-video-code-block",ctaOutputVideoSuccessContent:".pui-is-video .html-status-content"},cssClasses:{callback:"html-callback",navWrapperClass:"html-b-nav-wrapper",navItemClass:"html-nav",navChatClass:"html-nav-chat",navCallbackClass:"html-nav-callback",navVideoClass:"html-nav-video",active:"html-is-active",expanded:"pui-is-expanded",isChat:"pui-is-chat",npwChatExpanded:"npw-is-expanded",isCallback:"pui-is-callback",isVideo:"pui-is-video",isModuleOnline:"pui-is-online"}},_options:{},_eventNamespace:".PuiEventNamespace",_initComponentsOnPage:function(h){var f=this;var c=f._options;var e=c.selectors;var g=b(e.componentSelector);if(g.length!==1){console.log("Wrong page construction - none or more than 1 instance of CSOB live found.");return false}var d=g.eq(0);f.hasCallbackResponse=false;f.hasVideochatResponse=false;f._csobLiveNavigation(d);f._initSwitchNavigation();f._collapsibleWindow();f._checkCta();f._initChat();f._initCallback();f._initVideochat()},_csobLiveNavigation:function(k){var d=this;var p=d._options;var n=p.selectors;var m=p.cssClasses;var h=b("<ul></ul>");var i=b("<li><span></span></li>");h.addClass(m.navWrapperClass);k.append(h);i.addClass(m.navItemClass);var l=b(n.componentContent);var o=l.children("#chat").length>0;var e=l.children("#callback").length>0;var g=l.children("#video").length>0;if(o){var c=i.clone();c.addClass(m.navChatClass);b(n.navWrapper).append(c);c.find("span").text("Chat");c.data("link-content","#chat")}if(e){var j=i.clone();j.addClass(m.navCallbackClass);b(n.navWrapper).append(j);j.find("span").text("Zpětné volání");j.data("link-content","#callback")}if(g){var f=i.clone();f.addClass(m.navVideoClass);b(n.navWrapper).append(f);f.find("span").text("Videochat");f.data("link-content","#video")}},_initSwitchNavigation:function(){var f=this;var c=f._options;var e=c.selectors;var d=c.cssClasses;b(b(e.navItem)).off("click"+f._eventNamespace).on("click"+f._eventNamespace,function(j){var h=b(this);if(!f._isItemOnline(h).result){return false}var g=h.closest(e.navWrapper);var i=g.find(e.navItem);i.removeClass(d.active);h.addClass(d.active);b(e.componentSelector).removeClass(d.isModuleOnline);f._showChooseContent(h);b(e.componentSelector).addClass(d.expanded)})},_collapsibleWindow:function(){var f=this;var c=f._options;var e=c.selectors;var d=c.cssClasses;b(e.minimizeButton).off("click"+f._eventNamespace).on("click"+f._eventNamespace,function(h){b(e.componentSelector).removeClass(d.expanded).removeClass(d.isCallback).removeClass(d.isVideo).removeClass(d.isChat);b(e.navItem).removeClass(d.active);b(e.statusContent).text("ČSOB Živě");var g=b(".npw-c-chat").hasClass(d.npwChatExpanded);if(g){b(e.npwChatStatus).trigger("click")}})},_showChooseContent:function(g){var f=this;var c=f._options;var e=c.selectors;var d=c.cssClasses;var h=g.data("link-content");b(e.componentContent).children().removeClass(d.active);b(h).addClass(d.active);b(e.componentSelector).toggleClass(d.isModuleOnline,f._isItemOnline(g).result);if(h=="#chat"){f._checkChat();b(e.componentSelector).removeClass(d.isCallback).removeClass(d.isVideo);b(e.componentSelector).addClass(d.isChat)}if(h=="#callback"){b(e.statusContent).text("Callback "+f._isItemOnline(g).resultText);b(e.componentSelector).removeClass(d.isChat).removeClass(d.isVideo);b(e.componentSelector).addClass(d.isCallback)}if(h=="#video"){b(e.statusContent).text("Videochat "+f._isItemOnline(g).resultText);b(e.componentSelector).removeClass(d.isChat).removeClass(d.isCallback);b(e.componentSelector).addClass(d.isVideo)}},_isItemOnline:function(d){var c=(d.hasClass("html-is-online"));var e=(c)?"je online":"je offline";return{result:c,resultText:e}},_checkCta:function(){var f=this;var d=f._options;var e=d.selectors;var c=b(e.callback).find(e.ctaResponseSuccess).length>0;var g=b(e.video).find(e.ctaResponseSuccess).length>0;if(c){f.hasCallbackResponse=true}if(g){f.hasVideochatResponse=true}},_initChat:function(){var c=this;setTimeout((function(d){return function(){d._isChatOnline();if(!d.hasCallbackResponse&&!d.hasVideochatResponse){d._checkChatStart()}}})(this),1000);setInterval((function(d){return function(){d._isChatOnline()}})(this),10000)},_checkChat:function(){var g=this;var d=g._options;var f=d.selectors;var e=d.cssClasses;var h=b(f.chatStatusContent).text();b(f.statusContent).text(h);var c=b(".npw-c-chat").hasClass(e.npwChatExpanded);if(!(c)){b(f.npwChatStatus).trigger("click")}},_checkChatStart:function(){var g=this;var d=g._options;var f=d.selectors;var e=d.cssClasses;var c=b(".npw-c-chat").hasClass(e.npwChatExpanded);if((c)){b(f.navChat).trigger("click")}},_isChatOnline:function(){var e=this;var c=e._options;var d=c.selectors;var f=(Npw.ChatKeeper.state.chatStatus()===Npw.ChatKeeper.ChatStatusTypes.DISABLED||Npw.ChatKeeper.state.chatStatus()===Npw.ChatKeeper.ChatStatusTypes.HIDDEN);b(d.navChat).toggleClass("html-is-online",!f);b(d.isChat).toggleClass("pui-is-online",!f)},_initCallback:function(){var e=this;var c=e._options;var d=c.selectors;b(d.navCallback).addClass("html-is-online");if(e.hasCallbackResponse){b(d.navCallback).trigger("click")}},_initVideochat:function(){var e=this;var c=e._options;var d=c.selectors;var f=document.createElement("script");f.type="text/javascript";f.async=true;f.charset="UTF-8";f.src="//schuzka.csobpremium.cz/widget/OOWidget.js";f.$owidgetOnLoad=function(h){if(!h.isSupported){return}h.init("bf9a2115-3a17-401d-9625-d02a86f9d0e6","csobzive");h.connectToServer()};var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g);document.onreadystatechange=function(){if(document.readyState==="complete"){$owidget.setStatusUpdateCallback(function(h){switch(h){case 1:b(d.navVideo).addClass("html-is-online");b(d.isVideo).addClass("pui-is-online");b(d.ctaOutputVideoSuccessContent).text("Videochat je online");b(d.ctaOutputVideoSuccess).addClass("html-is-success");b(d.ctaOutputVideoSuccess).removeClass("html-is-error");b("#warning").empty();if(e.hasVideochatResponse){b(d.navVideo).trigger("click")}break;default:b(d.navVideo).removeClass("html-is-online");b(d.isVideo).removeClass("pui-is-online");b(d.ctaOutputVideoSuccessContent).text("Videochat je offline");b(d.ctaOutputVideoSuccess).addClass("html-is-error");b(d.ctaOutputVideoSuccess).removeClass("html-is-success");b("#warning").text("Aktuálně není dostupný žádný  bankéř. Opakujte svůj požadavek později.");break}})}};b("#btn-videochat-live").on("click",function(){var h=b("#telNr").val();if(h){if((h.length===6)&&(!isNaN(h))){b("#warning").empty();$owidget.openCall?$owidget.openCall(h):$owidget.widgetManager.openCall(h)}else{b("#warning").text("Chybné zadání. Správný kód Vám sdělí bankéř po telefonu.")}}})},_initCSOBLive:function(c){var d=this;d._options=b.extend({},d._defaults,c||{})},init:function(c){var d=this;var e=b(c);d._initComponentsOnPage(e)}})})(window.PuiTheme,jQuery);(function(a,b){b(document).ready(function(){if(typeof a.CSOBLive!=="undefined"){a.CSOBLive.initWidget()}})})(window.PuiTheme,jQuery);